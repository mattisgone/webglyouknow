
<html> 
  <head>
 
    <title>WebGLTest</title> 
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <!--
      Define a simple GLSL (OpenGL Shading Language) fragment shader.
      More info: http://en.wikipedia.org/wiki/GLSL
      -->
    <script id="shader-fs" type="x-shader/x-fragment">
        void main(void) {
            gl_FragColor = vec4(0.6, 0.0, 0.0, 1.0);
        }
    </script>
    <!--
      Define a simple GLSL (OpenGL Shading Language) vertex shader.
      More info: http://en.wikipedia.org/wiki/GLSL
      -->
    <script id="shader-vs" type="x-shader/x-vertex">
      attribute vec3 vertexPosition;
      uniform mat4 modelViewMatrix;
      uniform mat4 perspectiveMatrix;
      void main(void) {
        gl_Position = perspectiveMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);
      }
    </script>
    <script type="text/javascript">
      window.onload = loadScene;
      
      /**
       * Initialises WebGL and creates the 3D scene.
       */
      function loadScene()
      {
        var canvas = document.getElementById("webGLCanvas");
        var gl = canvas.getContext("experimental-webgl");
        gl.viewport(0, 0, canvas.width, canvas.height);

        var shader = {
          vert : gl.createShader(gl.VERTEX_SHADER),
          frag : gl.createShader(gl.FRAGMENT_SHADER),
          program : gl.createProgram()
        };
        
        var vertexShaderScript = document.getElementById("shader-vs");
        gl.shaderSource(shader.vert, vertexShaderScript.text);
        gl.compileShader(shader.vert);
        if(!gl.getShaderParameter(shader.vert, gl.COMPILE_STATUS)) {
          alert("Couldn't compile the vertex shader");
        }

        var fragmentShaderScript = document.getElementById("shader-fs");
        gl.shaderSource(shader.frag, fragmentShaderScript.text);
        gl.compileShader(shader.frag);
        if(!gl.getShaderParameter(shader.frag, gl.COMPILE_STATUS)) {
          alert("Couldn't compile the fragment shader");
        }

        gl.attachShader(shader.program, shader.vert);
        gl.attachShader(shader.program, shader.frag);
        gl.linkProgram(shader.program);
        gl.useProgram(shader.program);

        var vertexPosition = gl.getAttribLocation(shader.program, "vertexPosition");
        gl.enableVertexAttribArray(vertexPosition);
        
        gl.clearColor(0.0, 0.0, 0.0, 1.0);
        gl.clearDepth(1.0);
        gl.enable(gl.DEPTH_TEST);
        gl.depthFunc(gl.LEQUAL);
        
        var vertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
        var vertices = new Float32Array([
          0.0,  1.0,  4.0,
          -1.0, -1.0,  4.0,
          1.0, -1.0,  4.0
          ]);

        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
        
        var fieldOfView = 30.0;
        var aspectRatio = canvas.width / canvas.height;
        var nearPlane = 1.0;
        var farPlane = 10000.0;
        var top = nearPlane * Math.tan(fieldOfView * Math.PI / 360.0);
        var bottom = -top;
        var right = top * aspectRatio;
        var left = -right;

        var a = (right + left) / (right - left);
        var b = (top + bottom) / (top - bottom);
        var c = (farPlane + nearPlane) / (farPlane - nearPlane);
        var d = (2 * farPlane * nearPlane) / (farPlane - nearPlane);
        var x = (2 * nearPlane) / (right - left);
        var y = (2 * nearPlane) / (top - bottom);
        var perspectiveMatrix = [
          x, 0, a, 0,
          0, y, b, 0,
          0, 0, c, d,
          0, 0, -1, 0
        ];
        
        var modelViewMatrix = [
          1, 0, 0, 0,
          0, 1, 0, 0,
          0, 0, 1, 0,
          0, 0, 0, 1
        ];

        var vertexPosAttribLocation = gl.getAttribLocation(shader.program, "vertexPosition");
        gl.vertexAttribPointer(vertexPosAttribLocation, 3.0, gl.FLOAT, false, 0, 0);
        var uModelViewMatrix = gl.getUniformLocation(shader.program, "modelViewMatrix");
        var uPerspectiveMatrix = gl.getUniformLocation(shader.program, "perspectiveMatrix");

        gl.uniformMatrix4fv(uModelViewMatrix, false, new Float32Array(perspectiveMatrix));
        gl.uniformMatrix4fv(uPerspectiveMatrix, false, new Float32Array(modelViewMatrix));

        gl.drawArrays(gl.TRIANGLES, 0, vertices.length / 3.0);
      }
    </script>
  </head>
  <body>
    <canvas id="webGLCanvas" width="500" height="500"></canvas>
  </body>
</html> 
